<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6"
      class="light-style layout-menu-fixed layout-navbar-fixed"
      dir="ltr"
      data-theme="theme-default"
      data-assets-path="/admin/assets/"
      data-template="vertical-menu-template-free"
>
<head th:replace="~{admin/fragments/head :: heads(pageTitle='List Coupons')}">
    <title></title>
</head>

<style>
    body {
        font-size: 14px;
    }

    h1, h2, h3, h4, h5, h6 {
        font-size: 1.5em;
    }

    .fit {
        padding: 10px;
        width: fit-content;
    }
</style>

<body>
<div class="layout-wrapper layout-content-navbar">
    <div class="layout-container">
        <!--đưa giá trị value_menu để so sánh với menu kích hoạt active-->
        <aside th:replace="~{admin/fragments/menu :: drawer-menu(value_menu = 'coupon,couponList')}"></aside>
        <div class="layout-page">
            <!-- Nav-bar -->
            <nav th:replace="~{admin/fragments/nav :: nav-bar(value_title = 'Coupon List')}"></nav>

            <!-- Content wrapper -->
            <div class="content-wrapper">
                <!-- Content -->

                <div class="container-xxl container-p-y d-flex flex-column">

                    <div class="card mb-2">
                        <div class="card-body">
                            <!-- Coupon search -->
                            <div class="row g-3 mb-3">
                                <div class="flex-grow-1">
                                    <div class="d-flex justify-content-start">
                                        <button type="submit" class="btn btn-primary mr-2" onclick="searchCoupon()">Search</button>
                                        <button type="submit" class="btn btn-info mx-2" onclick="searchDefault()">Set default</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Search Entries -->
                            <div class="row g-3">

                            <form id="couponSearch"  th:object="${couponSearch}">

                                    <div class="d-flex">
                                        <div class="mb-2 pr-2">
                                            <label class="form-label" for="couponCode">Coupon Code</label>
                                            <input type="text"
                                                   class="form-control"
                                                   id="couponCode"
                                                   th:field="*{couponCode}"
                                                   placeholder="Coupon Code"
                                                   th:class="${#fields.hasErrors('couponCode')}? 'form-control fieldError' : 'form-control'"
                                                   maxlength="20"
                                                   oninput="formatCouponCode(this)"/>
                                            <p th:if="${#fields.hasErrors('couponCode')}" th:errors="*{couponCode}" th:errorclass="errorMessage"></p>
                                        </div>

                                        <div class="mb-2 pr-2">
                                            <label class="form-label" for="couponName">Coupon Name</label>
                                            <input type="text"
                                                   class="form-control"
                                                   id="couponName"
                                                   th:field="*{couponName}"
                                                   placeholder="Coupon name"
                                                   th:class="${#fields.hasErrors('couponName')}? 'form-control fieldError' : 'form-control'"
                                                   maxlength="30"/>
                                            <p th:if="${#fields.hasErrors('couponName')}" th:errors="*{couponName}" th:errorclass="errorMessage"></p>
                                        </div>

                                        <div class="mb-2 pr-2">
                                            <label class="form-label" for="datePicker-startDate">Start Date</label>
                                            <input type="date"
                                                   class="form-control"
                                                   id="datePicker-startDate"
                                                   th:field="*{startDate}"
                                                   th:class="${#fields.hasErrors('startDate')}? 'form-control
                                                                fieldError' : 'form-control'"/>
                                            <p th:if="${#fields.hasErrors('startDate')}" th:errors="*{startDate}" th:errorclass="errorMessage"></p>
                                            <script>
                                                <!--start date min is today-->
                                                document.getElementById("datePicker-startDate").min = new Date().toISOString().slice(0, 16);
                                            </script>
                                        </div>

                                        <div class="mb-2 pr-2">
                                            <label class="form-label" for="datePicker-endDate">End Date</label>
                                            <input type="date"
                                                   class="form-control"
                                                   id="datePicker-endDate"
                                                   th:field="*{endDate}"
                                                   th:class="${#fields.hasErrors('endDate')}? 'form-control fieldError' : 'form-control'"/>
                                            <p th:if="${#fields.hasErrors('endDate')}" th:errors="*{endDate}" th:errorclass="errorMessage"></p>
                                            <script>
                                                <!--end date min is today-->
                                                document.getElementById("datePicker-endDate").min = new Date().toISOString().slice(0, 16);
                                            </script>
                                        </div>

                                    </div>

                                    <div class="d-flex">
                                        <div class="mb-3 pr-2">
                                            <label class="form-label">Status</label>
                                            <select class="form-select" th:field="*{couponStatus}" id="couponStatus">
                                                <option value="" selected></option>
                                                <option th:each="status : ${T(vn.hdweb.team9.domain.entity.CouponStatus).values()}"
                                                        th:value="${status}"
                                                        th:text="${status}">option
                                                </option>
                                            </select>
                                        </div>

                                        <div class="mb-3 pr-2">
                                            <label class="form-label">Type Coupon</label>
                                            <select class="form-select" th:field="*{typeCoupon}" id="couponType">
                                                <option value="" selected></option>
                                                <option th:each="type : ${T(vn.hdweb.team9.domain.entity.TypeCoupon).values()}"
                                                        th:value="${type}"
                                                        th:text="${type}">option
                                                </option>
                                            </select>
                                        </div>

                                        <div class="mb-3 pr-2">
                                            <label class="form-label" for="couponValue">Coupon Value</label>
                                            <input
                                              type="number"
                                              class="form-control"
                                              id="couponValue"
                                              th:field="*{couponValue}"
                                              placeholder="Discount value"
                                              th:class="${#fields.hasErrors('couponValue')}? 'form-control fieldError' : 'form-control'"
                                              oninput="handleCouponNumberInput(this)"/>
                                            <p th:if="${#fields.hasErrors('couponValue')}" th:errors="*{couponValue}" th:errorclass="errorMessage"></p>
                                        </div>

                                        <div class="mb-3 pr-2">
                                            <label class="form-label" for="couponQuantity">Coupon Quantity</label>
                                            <input type="number"
                                                   class="form-control"
                                                   id="couponQuantity"
                                                   th:field="*{couponQuantity}"
                                                   placeholder="Coupon Quantity" th:class="${#fields.hasErrors('couponQuantity')}? 'form-control fieldError' : 'form-control'"
                                                   oninput="handleCouponNumberInput(this)"/>
                                            <p th:if="${#fields.hasErrors('couponQuantity')}" th:errors="*{couponQuantity}" th:errorclass="errorMessage"></p>
                                        </div>
                                    </div>
                            </form>
                            </div>
                        </div>
                    </div>

                    <!-- Coupon Table -->
                    <div class="card">
                        <div class="card-body">
                            <div class="card-content">
                                <div class="card">
                                    <h5 class="card-header">Coupons</h5>
                                    <div class="table-responsive text-nowrap">
                                        <table class="table table-striped" >
                                            <thead>
                                            <!-- Coupon ltable header -->
                                            <tr>
                                                <th>Name</th>
                                                <th>Code</th>
                                                <th>Type</th>
                                                <th>Value</th>
                                                <th>Quantity</th>
                                                <th>Start At</th>
                                                <th>End At</th>
                                                <th>Status</th>
                                                <th></th>
                                            </tr>
                                            </thead>
                                            <tbody class="table-border-bottom-0">
                                            <!-- Coupon list -->
                                            <tr th:each="coupon : ${coupons}">
                                                <td>
                                                    <i class="fab fa-bootstrap fa-lg text-primary me-1"></i>
                                                    <strong>[[${coupon.couponName}]]</strong>
                                                </td>
                                                <td>
                                                    <i class="fab fa-bootstrap fa-lg text-primary me-1"></i>
                                                    <strong>[[${coupon.couponCode}]]</strong>
                                                </td>
                                                <td>
                                                    <span class="badge me-1" th:classappend="${coupon.typeCoupon == T(vn.hdweb.team9.domain.entity.TypeCoupon).DIRECT ? 'bg-label-primary' : 'bg-label-info'}">
                                                        [[${coupon.typeCoupon}]]
                                                    </span></td>
                                                </td>
                                                <td>
                                                    <i class="fab fa-bootstrap fa-lg text-primary me-1"></i>
                                                    [[${coupon.couponValue}]]
                                                </td>
                                                <td>
                                                    <i class="fab fa-bootstrap fa-lg text-primary me-1"></i>
                                                    [[${coupon.couponQuantity}]]
                                                </td>
                                                <td>
                                                    <i class="fab fa-bootstrap fa-lg text-primary me-1"></i>
                                                    [[${coupon.startDate}]]
                                                </td>
                                                <td>
                                                    <i class="fab fa-bootstrap fa-lg text-primary me-1"></i>
                                                    [[${coupon.endDate}]]
                                                </td>
                                                <td>
                                                    <span class="badge me-1" th:classappend="${coupon.couponStatus == T(vn.hdweb.team9.domain.entity.CouponStatus).UPCOMING ? 'bg-label-info'
                                                      : coupon.couponStatus == T(vn.hdweb.team9.domain.entity.CouponStatus).AVAILABLE ? 'bg-label-success'
                                                      : coupon.couponStatus == T(vn.hdweb.team9.domain.entity.CouponStatus).PAST ? 'bg-label-danger'
                                                      : coupon.couponStatus == T(vn.hdweb.team9.domain.entity.CouponStatus).INACTIVE ? 'bg-label-secondary'
                                                      : 'bg-label-warning'}">
                                                        [[${coupon.couponStatus}]]
                                                    </span></td>
                                                <td>
                                                    <div style="display: flex; ">
                                                        <form th:action="@{'/admin/coupon/edit/' + ${coupon.id}}" method="get" id="editCouponForm" style="margin-right: 10px;">
                                                            <button type="submit" class="btn btn-outline-primary btn-sm">
                                                                <i class="bx bx-edit-alt me-1"></i>
                                                            </button>
                                                        </form>
                                                        <!--Hidden form for delete coupon-->
                                                        <form th:action="@{'/admin/coupon/delete/' + ${coupon.id}}" method="post" id="deleteCouponForm"></form>
                                                        <button type="submit" class="btn btn-outline-danger btn-sm" onclick="confirmDelete()">
                                                            <i class="bx bx-trash me-1"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>

                                            <!-- Delete Confirmation Modal -->
                                            <div class="modal fade" id="deleteConfirmationModal" tabindex="-1" aria-labelledby="deleteConfirmationModalLabel" aria-hidden="true">
                                                <div class="modal-dialog">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title" id="deleteConfirmationModalLabel">Confirm Delete</h5>
                                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                        </div>
                                                        <div class="modal-body">
                                                            Are you sure you want to delete this coupon?
                                                            This action cannot be undone.
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                                            <button type="submit" class="btn btn-danger" onclick="submitDeleteForm()">Delete</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--/ Basic Bootstrap Table -->
                </div>
                <!-- / Content -->

                <!-- Footer -->
                <div class="content-backdrop fade"></div>
            </div>
            <!-- Content wrapper -->
            <footer th:replace="~{admin/fragments/footer :: footer}"></footer>
        </div>
    </div>
    <div class="layout-overlay layout-menu-toggle"></div>
</div>
<div th:replace="~{admin/fragments/js :: js-insert}"></div>
</body>

<script>
    function confirmDelete() {
        $('#deleteConfirmationModal').modal('show');
    }

    function submitDeleteForm() {
        $('#deleteCouponForm').submit();
    }

    function handleKeyPress(event) {
        event = event || window.event;
        var keycode = event.keyCode || event.which;
        if (keycode === 13) { // 13 is the key code for Enter
            searchCoupon();
        }
    }

    function searchCoupon() {
        $('#couponSearch').submit();
    }


    function searchDefault() {
        // Clear all search fields
        document.getElementById("couponCode").value = "",
        document.getElementById("couponName").value = "",
        document.getElementById("couponType").value = "",
        document.getElementById("couponStatus").value = 0,
        document.getElementById("couponValue").value = 0,
        document.getElementById("couponQuantity").value = 0,
        document.getElementById("datePicker-startDate").value = "",
        document.getElementById("datePicker-endDate").value = "",
        // Trigger the search function after clearing
        searchCoupon();
    }

    function handleCouponNumberInput(input) {
        // Set value to 0 if the input is cleared
        if (input.value.trim() === '') {
            input.value = 0;
        }
    }

</script>

</html>


